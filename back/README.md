# University Entrance Exam API

このプロジェクトは大学入試科目情報を管理するための RESTful API です。

## 機能

- 大学情報の管理
- 学部・学科情報の管理
- 入試科目と配点の管理
- 入試日程の管理

## 技術スタック

- Go 1.21+
- Echo Framework
- GORM
- PostgreSQL
- Redis (キャッシュ)

## プロジェクト構造

```
/back
├── cmd/                     # アプリケーションのエントリーポイント（main.go）
├── internal/               # プライベートなアプリケーションコード（外部パッケージから使用不可）
│   ├── api/              # APIハンドラー
│   ├── domain/          # ドメインモデル
│   ├── repository/     # データアクセス層
│   └── service/       # ビジネスロジック
├── pkg/                   # 公開可能な再利用可能なコード（外部パッケージから使用可能）
├── scripts/              # データベース関連スクリプト
├── tests/               # テストファイル
├── configs/            # 設定ファイル
└── docs/              # ドキュメント
```

## セットアップ

1. 環境変数の設定

```bash
# セキュリティ上の理由から、.envファイルはGitにコミットしないでください
cp configs/.env.example .env
# 本番環境では、環境変数は安全な方法で管理してください
# 例: AWS Secrets Manager, HashiCorp Vault, 環境変数
```

2. 依存関係の管理

```bash
# Go Modulesを使用して依存関係を管理
go mod tidy    # 依存関係の整理
go mod verify  # 依存関係の検証
```

3. データベースの準備

```bash
make migrate
make seed
```

4. サーバーの起動

```bash
make run
```

## 開発

### 必要条件

- Go 1.21+
- PostgreSQL
- Make

### 便利なコマンド

```bash
make build      # バイナリのビルド
make test       # テストの実行（カバレッジレポート生成）
make migrate    # データベースマイグレーション
make seed       # テストデータの投入
make run        # 開発サーバーの起動
make lint       # コードの静的解析
```

### テスト

- テストカバレッジ: 80%以上を目標
- テストは`tests/`ディレクトリに配置
- テストの種類:
  - ユニットテスト: 個々の関数やメソッドのテスト
    - テストケースは`_test.go`ファイルに記述
    - テストヘルパーは`testutils`パッケージに配置
  - 統合テスト: 複数のコンポーネントの連携テスト
    - テストデータベースを使用
    - テストケースは独立して実行可能
  - API テスト: HTTP エンドポイントのテスト
    - リクエスト/レスポンスの検証
    - エラーハンドリングのテスト
  - パフォーマンステスト: 負荷テストとベンチマーク
    - ベンチマークは`_benchmark_test.go`ファイルに記述
    - 負荷テストは`loadtest`ディレクトリに配置

### エラーハンドリング

- エラーは`errors`パッケージを使用して定義
- エラーメッセージは日本語で記述
- エラーの種類:
  - バリデーションエラー
  - データベースエラー
  - 認証エラー
  - システムエラー
- エラーログは構造化ログとして記録
- エラーレスポンスは適切な HTTP ステータスコードと共に返却

### CI/CD

- GitHub Actions で自動テストとデプロイ
  - プルリクエスト時の自動テスト実行
  - マージ時の自動デプロイ
  - セキュリティスキャンの自動実行
- テストカバレッジの監視
  - Codecov によるカバレッジレポート
  - カバレッジ閾値の設定
- セキュリティスキャンの自動実行
  - OWASP Dependency Check
  - SonarQube による静的解析
- コード品質の自動チェック
  - golangci-lint による静的解析
  - コードフォーマットの自動修正

## API ドキュメント

API の詳細な仕様は `docs/api` ディレクトリを参照してください。

## セキュリティ

- 環境変数は安全に管理
  - 本番環境では環境変数マネージャーを使用
  - 機密情報は暗号化して保存
- 入力値のバリデーション
  - リクエストパラメータの型チェック
  - 入力値の長さ制限
  - 正規表現によるフォーマットチェック
- SQL インジェクション対策
  - プリペアドステートメントの使用
  - ORM の適切な使用
  - クエリビルダーの使用
- XSS 対策
  - 入力値のサニタイズ
  - 適切な Content-Type の設定
  - CSP (Content Security Policy) の設定
- CSRF 対策
  - CSRF トークンの実装
  - SameSite Cookie の設定
  - 二重送信防止トークンの使用
- レート制限の実装
  - IP アドレスベースの制限
  - ユーザーアカウントベースの制限
  - スロットリングの実装
- セキュアなヘッダーの設定
  - HSTS の設定
  - X-Frame-Options の設定
  - X-Content-Type-Options の設定

## ライセンス

本ソフトウェアは、UniversityEntranceExamSubjectNavi Team が著作権を有する独占的なソフトウェアです。

### 使用条件

1. ライセンス付与

   - 本ソフトウェアの使用権は、正規のライセンス契約を締結し、
     規定の対価を支払った教育機関および個人にのみ付与されます。

2. 使用制限

   - 本ソフトウェアの複製、変更、結合、公開、配布、サブライセンス、
     販売等の行為は、書面による明示的な許可なく行うことはできません。
   - リバースエンジニアリング、逆コンパイル、逆アセンブルは禁止されています。

3. 教育機関向け特別条項
   - 教育機関は利用開始前に所定の契約手続きを完了する必要があります
   - 利用者数に応じたライセンス料金を支払う必要があります

### 著作権表示

Copyright (c) 2024 UniversityEntranceExamSubjectNavi Team
All Rights Reserved.

### お問い合わせ

- 契約関連：contract@example.com
- 技術サポート：support@example.com
- セキュリティ報告：security@example.com
